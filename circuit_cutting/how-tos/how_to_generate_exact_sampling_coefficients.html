<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to generate exact sampling coefficients &#8212; Circuit Knitting Toolbox 0.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CutQC (legacy circuit cutting implementation)" href="../cutqc/index.html" />
    <link rel="prev" title="How to generate exact quasiprobability distributions from Sampler" href="how_to_generate_exact_quasi_dists_from_sampler.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="How-to-generate-exact-sampling-coefficients">
<h1>How to generate exact sampling coefficients<a class="headerlink" href="#How-to-generate-exact-sampling-coefficients" title="Permalink to this heading">¶</a></h1>
<p>This how-to guide is intended to show users how they can generate exact sampling coefficients to be used in reconstructing the simulated expectation value of the original circuit.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">EfficientSU2</span>
<span class="kn">from</span> <span class="nn">qiskit.quantum_info</span> <span class="kn">import</span> <span class="n">PauliList</span>
<span class="kn">from</span> <span class="nn">qiskit_aer.primitives</span> <span class="kn">import</span> <span class="n">Sampler</span>

<span class="kn">from</span> <span class="nn">circuit_knitting_toolbox.circuit_cutting</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">partition_problem</span><span class="p">,</span>
    <span class="n">execute_experiments</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circuit</span> <span class="o">=</span> <span class="n">EfficientSU2</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">entanglement</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">assign_parameters</span><span class="p">([</span><span class="mf">0.8</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">observables</span> <span class="o">=</span> <span class="n">PauliList</span><span class="p">([</span><span class="s2">&quot;ZZZZ&quot;</span><span class="p">])</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;mpl&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/circuit_cutting_how-tos_how_to_generate_exact_sampling_coefficients_2_0.png" src="../../_images/circuit_cutting_how-tos_how_to_generate_exact_sampling_coefficients_2_0.png" />
</div>
</div>
<p>Partition the circuit between qubits 1 and 2 by cutting 2 CNOT gates.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subcircuits</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">subobservables</span> <span class="o">=</span> <span class="n">partition_problem</span><span class="p">(</span>
    <span class="n">circuit</span><span class="o">=</span><span class="n">circuit</span><span class="p">,</span> <span class="n">partition_labels</span><span class="o">=</span><span class="s2">&quot;AABB&quot;</span><span class="p">,</span> <span class="n">observables</span><span class="o">=</span><span class="n">observables</span>
<span class="p">)</span>
<span class="n">subcircuits</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;mpl&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/circuit_cutting_how-tos_how_to_generate_exact_sampling_coefficients_4_0.png" src="../../_images/circuit_cutting_how-tos_how_to_generate_exact_sampling_coefficients_4_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subcircuits</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;mpl&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/circuit_cutting_how-tos_how_to_generate_exact_sampling_coefficients_5_0.png" src="../../_images/circuit_cutting_how-tos_how_to_generate_exact_sampling_coefficients_5_0.png" />
</div>
</div>
<section id="Demonstrate-how-to-find-the-minimum-number-of-samples-needed-to-retrieve-exact-weights-for-2-CNOT-cuts">
<h2>Demonstrate how to find the minimum number of samples needed to retrieve exact weights for 2 CNOT cuts<a class="headerlink" href="#Demonstrate-how-to-find-the-minimum-number-of-samples-needed-to-retrieve-exact-weights-for-2-CNOT-cuts" title="Permalink to this heading">¶</a></h2>
<p>In order to retrieve exact coefficients and use them during reconstruction, the number of samples taken must be sufficient to cover the entire distribution. More specifically, if the smallest sample probability in the joint quasi-probability distribution is above 1 / <code class="docutils literal notranslate"><span class="pre">num_samples</span></code>, exact weights will be used. Otherwise, the weights will be sampled, resulting in at most <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> unique samples.</p>
<p>Here, we are cutting two CNOT gates. As shown below, the probability of any given mapping in a CNOT decomposition is 1/6, so the probability of any given mapping in the joint distribution combining the two cut CNOT gates is (1/6)2. Therefore, we need to take at least 6^2 samples in order to retrieve the exact weights from <code class="docutils literal notranslate"><span class="pre">execute_experiments</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">circuit_knitting_toolbox.circuit_cutting.qpd</span> <span class="kn">import</span> <span class="n">QPDBasis</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.library.standard_gates</span> <span class="kn">import</span> <span class="n">CXGate</span>

<span class="n">qpd_basis_cx</span> <span class="o">=</span> <span class="n">QPDBasis</span><span class="o">.</span><span class="n">from_gate</span><span class="p">(</span><span class="n">CXGate</span><span class="p">())</span>

<span class="n">num_cx_cuts</span> <span class="o">=</span> <span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mapping probabilities for a CNOT decomposition: </span><span class="si">{</span><span class="n">qpd_basis_cx</span><span class="o">.</span><span class="n">probabilities</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Number of samples needed to retrieve exact weights: </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">qpd_basis_cx</span><span class="o">.</span><span class="n">probabilities</span><span class="p">)</span><span class="o">**</span><span class="n">num_cx_cuts</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mapping probabilities for a CNOT decomposition: [0.16666667 0.16666667 0.16666667 0.16666667 0.16666667 0.16666667]
Number of samples needed to retrieve exact weights: 36.0
</pre></div></div>
</div>
</section>
<section id="Observe-the-coefficient-weights-returned-from-execute_experiments-are-WeightType.EXACT">
<h2>Observe the coefficient weights returned from <code class="docutils literal notranslate"><span class="pre">execute_experiments</span></code> are <code class="docutils literal notranslate"><span class="pre">WeightType.EXACT</span></code><a class="headerlink" href="#Observe-the-coefficient-weights-returned-from-execute_experiments-are-WeightType.EXACT" title="Permalink to this heading">¶</a></h2>
<p>Above, we determined 36 samples would trigger the coefficients to be returned as exact. Here we set <code class="docutils literal notranslate"><span class="pre">num_samples</span></code> to exactly 36 to test this.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="p">(</span><span class="n">run_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shots&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

<span class="n">quasi_dists</span><span class="p">,</span> <span class="n">coefficients</span> <span class="o">=</span> <span class="n">execute_experiments</span><span class="p">(</span>
    <span class="n">circuits</span><span class="o">=</span><span class="n">subcircuits</span><span class="p">,</span>
    <span class="n">subobservables</span><span class="o">=</span><span class="n">subobservables</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span>
    <span class="n">samplers</span><span class="o">=</span><span class="n">sampler</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">coefficients</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;),
 (-0.25, &lt;WeightType.EXACT: 1&gt;),
 (0.25, &lt;WeightType.EXACT: 1&gt;)]
</pre></div></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Circuit Knitting Toolbox</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Circuit Cutting Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/index.html">Circuit Cutting Explanatory Material</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Circuit Cutting How-To Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#circuit-cutting-how-tos">Circuit Cutting How-Tos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cutqc/index.html">CutQC (legacy circuit cutting implementation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../entanglement_forging/tutorials/index.html">Entanglement Forging Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../entanglement_forging/explanation/index.html">Entanglement Forging Explanatory Material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../entanglement_forging/how-tos/index.html">Entanglement Forging How-To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidocs/index.html">API References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Circuit Cutting How-To Guides</a><ul>
      <li>Previous: <a href="how_to_generate_exact_quasi_dists_from_sampler.html" title="previous chapter">How to generate exact quasiprobability distributions from Sampler</a></li>
      <li>Next: <a href="../cutqc/index.html" title="next chapter">CutQC (legacy circuit cutting implementation)</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/circuit_cutting/how-tos/how_to_generate_exact_sampling_coefficients.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>